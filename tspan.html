<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fabric.js Canvas Example</title>
    <script src="./fabric.min.js"></script>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <canvas id="myCanvas" width="1800" height="1000"></canvas>
    <script>
        // Initialize Fabric.js canvas
        var canvas = new fabric.Canvas('myCanvas');
        const svgPath = './svg.svg';
        const importSvgCode = (ss, canvas) => {
            if (ss) {
                fabric.loadSVGFromString(ss).then(output => {
                    parseSvg(output, canvas);
                });
                canvas.requestRenderAll();
            }
        };


        const parseSvg = (output, canvas) => {
            console.log(output)
            // eslint-disable-next-line
            const { objects, elements, options, allElements } = output;

            const index1 = allElements.findIndex((svgTag) => svgTag.tagName === 'extraproperty');
            const width = allElements[index1].getAttribute('width');
            const textAlign = allElements[index1].getAttribute('textAlign');
            const lines = allElements[index1].getAttribute('lines');
            console.log(width, textAlign, lines)
            objects.forEach((obj, index) => {
                if (obj.type === 'text') {
                    const currentElement = elements[index];
                    const tspan = currentElement.children[0]
                    const { x, y } = tspan.attributes;

                    var aa = '';
                    Array.from(currentElement.children).forEach((child, index) => {
                        aa +=child.innerHTML +'\n';
                    });
                    console.log(aa)
                    obj.left += Number(x.value)
                    obj.top += Number(y.value)

                    const text = new fabric.Textbox(aa, {
                        ...obj,
                        // textAlign
                        // width: parseInt(width),
                    })
                    return canvas?.add(text);
                }
                else {
                    canvas.add(obj);
                }
            });
        }
        const generateUniqueId = (object) => {
            return object.type + "_" + Number(Math.floor(Math.random() * 900) + 100); // Generates a number between 100 and 999
        };
        const shadowOptions = {
            color: "#000000",
            blur: 30,
            offsetX: 0,
            offsetY: 0,
            affectStroke: false,
        };

        const importSVG = (file) => {
            if (file) {
                var site_url = file;
                fabric.loadSVGFromURL(site_url).then(output => {
                    parseSvg(output, canvas);
                });
                canvas.renderAll();
            }
        };

        importSVG(svgPath)

    </script>
</body>

</html>